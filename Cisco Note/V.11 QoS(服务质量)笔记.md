Q(quality)o(of)S(service)
要控制的服务质量有
1传输的带宽
2传输的时延和抖动
3数据包的丢包率

在网络中部署的是ip qos

带宽：BWmax=Mni（链路上的速度）

端到端时延：路径上所有传输时延、处理时延与队列时延之和。

	传输时延又叫串行化时延，它的大小在很大程度上取决于带宽的大小。
	处理时延是指路由器把数据包从入接口放到出接口队列需要的时间，它的大小跟路由器的处理性能有关。
	队列时延指数据包在出口队列中停留的时间，它的大小跟队列中数据包的大小和数量、带宽以及队列机制有关。

抖动：每个包的时延不一样造成的抖动

丢包：数据包因为链路问题或者路由器问题或者队列满了（丢弃尾部收到的包）而导致的丢包


# **QoS有三种模式：**
Best Effort（尽力而为）
IntServ（Integrated Services，集成服务）
DiffServ（Differentiated Services，区分服务）

传统的网络采用的模式是Best Effort（尽力而为），对所有报文一视同仁

## **DiffServ 的工作原理：**

分类（Classification）
DiffServ 根据 IP 地址、TCP/UDP 端口号、CoS / DSCP / IP Precedence 值等信息，确定数据包的优先级类别（Class）。

标记（Marking）
给分类后的数据包打标签  
主要使用 **CoS**（Class of Service，服务类别）和 **DSCP**（Differentiated Services Code Point，区分服务代码点）进行标记。

- **CoS（Class of Service）**  
    CoS 是以太网帧的优先级标识。在 IEEE 802.1Q VLAN 标签的 4 字节扩展字段中，包含一个 **PRI（PCP）** 字段，该字段可用于表示 CoS 值。  
    CoS 采用 3 位字段，共有 8 个优先级（0～7）。数值越大，优先级越高。推荐的分类方式    语音数据：5   视频会议：4   普通数据：0～2
    
【 IEEE802.1Q 标签的以太网帧 】

+------------------+------------------+------+---------+------+------+------+
|   目标MAC地址    |      源MAC地址     |  标签  | 类型    | 数据  | 帧校验序列 |
+------------------+------------------+------+---------+------+------+------+
→                                                             ↓ ↓ ↓          
→                                          +------+-----+-----+------+------+
→                                           | TPID |   PCP    |   CFI   |     VID     |
→                                           | TPID | 优先级 |   CFI   | VLAN ID |
→                                          +------+-----+-----+------+------+

PCP（优先级代码点）：IEEE802.1p 规定的用于表示帧优先级的信息，取值范围为「0～7」。

- **DSCP（Differentiated Services Code Point）**  
    DSCP 在 IPv4 头部的 ToS（Type of Service，服务类型）字段中定义。  
    ToS 字段为 8 位，其中前 6 位用于表示 DSCP 值，可定义 64 级优先级（0～63）。  
    **IP Precedence**（IP 优先级）是 ToS 字段的另一种优先级标记方式，仅使用前 3 位，可定义 8 级优先级（0～7）。
    
    各路由器和交换机会根据 DSCP 值决定如何转发数据包，并按照 **PHB（Per-Hop Behavior，逐跳行为）** 进行流量处理。  
    
排队（Queuing）

排队是指将待发送的数据包存储在 **队列（Queue）** 中。  
网络设备通常具有多个队列，根据优先级将数据包存入不同的队列。  
队列分为 **软件队列** 和 **硬件队列**，数据包优先存入软件队列，然后根据调度策略进入硬件队列。

调度（Scheduling）

调度决定了软件队列中的数据包以何种顺序和比例进入硬件队列。  
即，从多个队列中选择哪个队列中的数据包先发送。

##### **常见的排队及调度方式：**

- **FIFO（First In First Out）**：  
    按数据包到达的顺序依次发送，是默认的排队方式。
    
- **PQ（Priority Queuing）**：  
    提供 4 个优先级队列（High、Medium、Normal、Low），高优先级队列的数据包会被优先发送，直到高优先级队列为空时，低优先级队列的数据包才会发送。
    
- **WFQ（Weighted Fair Queuing）**：  
    按通信流量自动创建队列，并根据优先级加权公平调度。
    
- **CB-WFQ（Class-Based WFQ）**：  
    用户可为不同类别的流量分配队列，并指定最低带宽保障。
    
- **LLQ（Low Latency Queuing）**：  
    在 CB-WFQ 基础上加入 PQ，允许高优先级队列的数据包优先发送，但设定带宽上限，避免低优先级队列长期无法发送。